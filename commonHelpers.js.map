{"version":3,"file":"commonHelpers.js","sources":["../src/search-api.js","../src/index.js"],"sourcesContent":["// search-api.js\n\nimport axios from 'axios';\nconst PIXABAY_API_KEY = '37408613-d3e7a4c0184cf3ce3e63dcb61';\nconst BASE_URL = 'https://pixabay.com/api/';\n\nconst IMAGE_PARAM_TEMPLATE = {\n  key: PIXABAY_API_KEY,\n  q: '',\n  image_type: 'photo',\n  orientation: 'horizontal',\n  safesearch: true,\n};\n\nfunction getSearchUrl(params) {\n  return `${BASE_URL}?${params}`;\n}\n\nfunction getParams(query, template) {\n  template.q = query;\n  return new URLSearchParams(template);\n}\n\nasync function fetchUrl(query, searchTemplate = { key: PIXABAY_API_KEY }) {\n  const params = getParams(query, searchTemplate);\n  const data = await axios.get(getSearchUrl(params));\n  return data;\n}\n\nexport function findImages(searchQuery, per_page = 20, page = 1) {\n  IMAGE_PARAM_TEMPLATE.per_page = per_page;\n  IMAGE_PARAM_TEMPLATE.page = page;\n\n  return fetchUrl(searchQuery, IMAGE_PARAM_TEMPLATE);\n}\n","import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport { findImages } from './search-api';\n\nconst elements = {\n  searchForm: document.querySelector('.search-form'),\n  gallery: document.querySelector('.gallery'),\n  load: document.querySelector('.js-load'),\n};\n\nconst PER_PAGE = 40;\n\nlet totalHits = 0;\nlet currentPage = 1;\nlet searchQuery = '';\n\nlet gallery = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nconst guardOptions = {\n  root: null,\n  rootMargin: '250px',\n  threshold: 1.0,\n};\n\nconst scrollObserver = new IntersectionObserver(handlerLoadMore, guardOptions);\n\nasync function handlerLoadMore(entries) {\n  entries.forEach(async entry => {\n    if (entry.isIntersecting) {\n      currentPage += 1;\n      const searchResult = await findImages(searchQuery, PER_PAGE, currentPage);\n\n      const totalPages = Math.ceil(totalHits / PER_PAGE);\n      const pagesArray = Array.from(\n        { length: totalPages },\n        (_, index) => index + 1\n      );\n\n      if (pagesArray.includes(currentPage)) {\n        renderSearchResult(searchResult.data);\n\n        if (currentPage === totalPages) {\n          scrollObserver.unobserve(elements.load);\n          showMessage(\"You've reached the end of search results.\");\n        }\n      }\n    }\n  });\n}\n\nfunction getListItemsHTML(hits) {\n  return hits\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => {\n        return `            \n          <div class=\"photo-card\">\n            <a href=\"${largeImageURL}\"><img class=\"image\" src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" /></a>\n            <div class=\"info\">\n              <p class=\"info-item\">\n                <b>Likes</b>\n                <span>${likes}</span> \n              </p>\n              <p class=\"info-item\">\n                <b>Views</b>\n                <span>${views}</span>\n              </p>\n              <p class=\"info-item\">\n                <b>Comments</b>\n                <span>${comments}</span>\n              </p>\n              <p class=\"info-item\">\n                <b>Downloads</b>\n                <span>${downloads}</span>\n              </p>\n            </div>\n          </div>            \n        `;\n      }\n    )\n    .join('');\n}\n\nasync function renderSearchResult(data) {\n  elements.gallery.insertAdjacentHTML('beforeend', getListItemsHTML(data.hits));\n  gallery.refresh();\n\n  window.scrollBy({\n    top: 0,\n    behavior: 'smooth',\n  });\n}\n\nfunction showErrorMessage(errorMessage) {\n  iziToast.show({\n    message: errorMessage,\n    messageColor: 'white',\n    backgroundColor: 'red',\n    timeout: 2500,\n    position: 'topRight',\n  });\n}\n\nfunction showMessage(message) {\n  iziToast.show({\n    message: message,\n    messageColor: 'white',\n    backgroundColor: 'green',\n    timeout: 3000,\n    position: 'topRight',\n  });\n}\n\nfunction resetSearchData() {\n  elements.gallery.innerHTML = '';\n  totalHits = 0;\n  currentPage = 1;\n  searchQuery = '';\n}\n\nasync function onSearchFormSubmit(evt) {\n  evt.preventDefault();\n  const form = new FormData(elements.searchForm);\n  const userInput = form.get('searchQuery').trim().toLowerCase();\n\n  if (!userInput) {\n    showErrorMessage('Search query must not be empty!');\n    return;\n  }\n\n  scrollObserver.unobserve(elements.load);\n  resetSearchData();\n\n  searchQuery = userInput;\n  const searchResult = await findImages(searchQuery, PER_PAGE);\n\n  if (searchResult.data.hits.length === 0) {\n    showErrorMessage('No images match your search query. Please try again.');\n    return;\n  }\n\n  totalHits = searchResult.data.totalHits;\n  showMessage(`Hooray! We found ${totalHits} images.`);\n  renderSearchResult(searchResult.data);\n\n  const totalPages = Math.ceil(totalHits / PER_PAGE);\n  if (PER_PAGE * currentPage < totalHits) {\n    scrollObserver.observe(elements.load);\n  }\n}\n\nelements.searchForm.addEventListener('submit', onSearchFormSubmit);\n"],"names":["PIXABAY_API_KEY","BASE_URL","IMAGE_PARAM_TEMPLATE","getSearchUrl","params","getParams","query","template","fetchUrl","searchTemplate","axios","findImages","searchQuery","per_page","page","elements","PER_PAGE","totalHits","currentPage","gallery","SimpleLightbox","guardOptions","scrollObserver","handlerLoadMore","entries","entry","searchResult","totalPages","_","index","renderSearchResult","showMessage","getListItemsHTML","hits","webformatURL","largeImageURL","tags","likes","views","comments","downloads","data","showErrorMessage","errorMessage","iziToast","message","resetSearchData","onSearchFormSubmit","evt","userInput"],"mappings":"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"}