{"version":3,"file":"commonHelpers.js","sources":["../src/search-api.js","../src/index.js"],"sourcesContent":["import axios from 'axios';\nconst PIXABAY_API_KEY = '37408613-d3e7a4c0184cf3ce3e63dcb61';\nconst BASE_URL = 'https://pixabay.com/api/';\n\nconst IMAGE_PARAM_TEMPLATE = {\n  key: PIXABAY_API_KEY,\n  q: '',\n  image_type: 'photo',\n  orientation: 'horizontal',\n  safesearch: true,\n};\n\nfunction getSearchUrl(params) {\n  return `${BASE_URL}?${params}`;\n}\n\nfunction getParams(query, template) {\n  template.q = query;\n  return new URLSearchParams(template);\n}\n\nasync function fetchUrl(query, searchTemplate = { key: PIXABAY_API_KEY }) {\n  const params = getParams(query, searchTemplate);\n  const data = await axios.get(getSearchUrl(params));\n  return data;\n}\n\nexport function findImages(searchQuery, per_page = 20, page = 1) {\n  IMAGE_PARAM_TEMPLATE.per_page = per_page;\n  IMAGE_PARAM_TEMPLATE.page = page;\n\n  return fetchUrl(searchQuery, IMAGE_PARAM_TEMPLATE);\n}\n","import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport { findImages } from './search-api';\n\nconst elements = {\n  searchForm: document.querySelector('.search-form'),\n  searchButton: document.querySelector('button[type=\"submit\"]'),\n  gallery: document.querySelector('.gallery'),\n  load: document.querySelector('.js-load'),\n};\n\nconst PER_PAGE = 40;\n\nlet totalHits = 0;\nlet currentPage = 1;\nlet searchQuery = '';\n\nlet gallery = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nconst guardOptions = {\n  root: null,\n  rootMargin: '250px',\n  treshhold: 1.0,\n};\n\nconst scrollObserver = new IntersectionObserver(handlerLoadMore, guardOptions);\n\nfunction handlerLoadMore(entries) {\n  entries.forEach(entry => {\n    if (entry.isIntersecting) {\n      currentPage += 1;\n      const searchResult = findImages(searchQuery, PER_PAGE, currentPage);\n\n      searchResult\n        .then(result => {\n          renderSearchResult(result.data);\n\n          if (PER_PAGE * currentPage >= totalHits) {\n            scrollObserver.unobserve(elements.guard);\n            showMessage(\n              \"We're sorry, but you've reached the end of search results.\"\n            );\n          }\n        })\n        .catch(err => showErrorMessage(err.message));\n    }\n  });\n}\n\nfunction getListItemsHTML(hits) {\n  return hits\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => {\n        return `            \n                <div class=\"photo-card\">\n                    <a href=\"${largeImageURL}\"><img class=\"image\" src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" /></a>\n                    <div class=\"info\">\n                        <p class=\"info-item\">\n                            <b>Likes</b>\n                            <span>${likes}</span> \n                        </p>\n                        <p class=\"info-item\">\n                            <b>Views</b>\n                            <span>${views}</span>\n                        </p>\n                        <p class=\"info-item\">\n                            <b>Comments</b>\n                            <span>${comments}</span>\n                        </p>\n                        <p class=\"info-item\">\n                            <b>Downloads</b>\n                            <span>${downloads}</span>\n                        </p>\n                    </div>\n                </div>            \n        `;\n      }\n    )\n    .join('');\n}\n\nfunction renderSearchResult(data) {\n  elements.gallery.insertAdjacentHTML('beforeend', getListItemsHTML(data.hits));\n  gallery.refresh();\n\n  window.scrollBy({\n    top: 0,\n    behavior: 'smooth',\n  });\n}\n\nfunction showErrorMessage(errorMessage) {\n  iziToast.show({\n    message: errorMessage,\n    messageColor: 'white',\n    backgroundColor: 'red',\n    timeout: 2500,\n    position: 'topRight',\n  });\n}\n\nfunction showMessage(message) {\n  iziToast.show({\n    message: message,\n    messageColor: 'white',\n    backgroundColor: 'green',\n    timeout: 3000,\n    position: 'topRight',\n  });\n}\n\nfunction resetSearchData() {\n  elements.gallery.innerHTML = '';\n  totalHits = 0;\n  currentPage = 1;\n  searchQuery = '';\n}\n\nfunction onSearchButtonClick(evt) {\n  evt.preventDefault();\n  const form = new FormData(elements.searchForm);\n  const userInput = form.get('searchQuery').trim().toLowerCase();\n\n  if (!userInput) {\n    showErrorMessage('Search query must be not empty!');\n    return;\n  }\n\n  scrollObserver.unobserve(elements.load);\n  resetSearchData();\n\n  searchQuery = userInput;\n  const searchResult = findImages(searchQuery, PER_PAGE);\n\n  searchResult\n    .then(result => {\n      if (result.data.hits.length === 0) {\n        throw new Error(\n          'Sorry, there are no images matching your search query. Please try again.'\n        );\n      }\n\n      totalHits = result.data.totalHits;\n\n      showMessage(`Hooray! We found ${totalHits} images.`);\n      renderSearchResult(result.data);\n\n      if (PER_PAGE * currentPage < totalHits) {\n        scrollObserver.observe(elements.load);\n      }\n    })\n    .catch(err => showErrorMessage(err.message));\n}\n\nelements.searchButton.addEventListener('click', onSearchButtonClick);\n"],"names":["PIXABAY_API_KEY","BASE_URL","IMAGE_PARAM_TEMPLATE","getSearchUrl","params","getParams","query","template","fetchUrl","searchTemplate","axios","findImages","searchQuery","per_page","page","elements","PER_PAGE","totalHits","currentPage","gallery","SimpleLightbox","guardOptions","scrollObserver","handlerLoadMore","entries","entry","result","renderSearchResult","showMessage","err","showErrorMessage","getListItemsHTML","hits","webformatURL","largeImageURL","tags","likes","views","comments","downloads","data","errorMessage","iziToast","message","resetSearchData","onSearchButtonClick","evt","userInput"],"mappings":"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"}